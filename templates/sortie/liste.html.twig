{% extends 'base.html.twig' %}

{% block body %}
    <hr>
    {% block content %}

        <h2>Recherche par filtre</h2>

        <div class="container-presentation">
            <div id="titre-liste">
                <h2>Voici la liste des sorties ouvertes pour {{ app.user.prenom }}</h2>
            </div>
        </div>
        <div class="container-liste-ajouter">
            <a id="btn-ajout" href="{{ path('sortie_creation') }}">Ajouter une sortie</a>
        </div>
        <div id="dispo-sortie">
        <p>Nombre de sorties disponibles : {{ nbreSortie }}</p>
        {{ form_start(form) }}
        {{ form_widget(form) }}
        <button type="submit">
            rechercher
        </button>
        {{ form_end(form) }}
<br>
        {% for message in app.flashes('success') %}
            <div class="alert alert-success">
                {{ message }}
            </div>
        {% endfor %}
        {% for message in app.flashes('echec') %}
            <div class="alert alert-success">
                {{ message }}
            </div>
        {% endfor %}
        {% for message in app.flashes('warning') %}
            <div class="alert alert-success">
                {{ message }}
            </div>
        {% endfor %}
        </br>

    {% endblock %}
    <hr>
    <div class="container-liste-1">
        <h2>Voici la liste des sorties ouvertes pour {{ app.user.prenom }}</h2>
        <p>Nombre total de sortie crées sur ce site {{ nbreSortie }}</p>

        <a href="{{ path('sortie_creation') }}"> Ajouter une sortie</a>
        <hr>

    </div>

    <div class="container-general">
        <ol>
            {% for sortie in sorties %}
            {% if sortie.etat.id == 2 or sortie.etat.id == 7 %}
            {% set inscrit = false %}
        </ol>
        <div class="container-bloc">
            <div class="liste-1">
                <hr>
                <a id="nom-sortie" href="{{ path('sortie_detail',{'detail_id':sortie.id}) }}">{{ sortie.nom }}</a>
                organisé par
                <a id="pseudo-sortie"
                   href="{{ path('participant_profil',{'pseudo':sortie.organisateur.pseudo}) }}">{{ sortie.organisateur.pseudo }}</a>
                <hr>
                <div class="container-description">
                    <ul class="liste-description">
                        <!-- bloc description -->
                        <p id="p-lieu"><strong id="lieu-text"> Lieu de la sortie :</strong> {{ sortie.lieu.nom }}
                            : {{ sortie.lieu.rue }}</p>
                        <p>Début de la sortie : {{ sortie.dateHeureDebut | date('d/m/y H:i') }}</p>
                        <p>Fin des inscriptions : {{ sortie.dateLimiteInscription | date('d/m/y H:i') }}</p>
                        {# <p>Etat de l'activité : {{ sortie.etat.libelle }} </p> #}
                        <p>Liste des participants inscrits à cette sortie :</p>
                        <p>Participants : {{ sortie.participants|length }}/{{ sortie.nbInscriptionsmax }}
                            {% if (sortie.participants|length >= sortie.nbInscriptionsmax) %}
                            => Sortie complète</p>
                        {% endif %}
                        <!-- bloc liste participant -->
                        <div id="bloc-participant">
                            <ul>
                                {% for perso in sortie.participants %}
                                    <li><a id="lien-participant"
                                           href="{{ path('participant_profil',{'pseudo':perso.prenom}) }}">{{ perso.prenom }}</a>
                                    </li>
                                {% else %}
                                    <p id="pas-participant">Pas de participants pour le moment</p>
                                {% endfor %}
                            </ul>

                        </div>
                    </ul>
                    <div class="container-controle">
                        <nav>
                            {% if sortie.etat.id == 1 %}
                                <a class="btn-inscription" href="{{ path('sortie_liste') }}">Publier</a>
                            {% endif %}

                            {% for perso in sortie.participants %}
                                {% if app.user.pseudo==perso.pseudo %}
                                    <a class="btn-desinscrire"
                                       href="{{ path('desinscrire_sortie',{'sortie_id':sortie.id}) }}">Se
                                        désinscrire</a>
                                    {% set inscrit=true %}
                                {% endif %}
                            {% endfor %}

                            {% if ((inscrit == false) and ((sortie.etat.id == 2) or (sortie.etat.id == 3))) and (sortie.participants|length < sortie.nbInscriptionsmax) %}
                                <a class="btn-inscription" href="{{ path('inscrire_sortie',{'sortie_id':sortie.id}) }}">S'inscrire</a>
                            {% endif %}

                            {% if sortie.etat.id is same as 7 %}
                                <p id="annulation"> Desolée cette sortie a du être annulée</p>
                            {% endif %}
                        </nav>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    </div>
{% endblock %}
